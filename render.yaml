# ============================================================================
# RENDER BLUEPRINT - Food Delivery Microservices
# ============================================================================

services:
  # ==========================================================================
  # Service Registry (Eureka) - MUST START FIRST
  # ==========================================================================
  - type: web
    name: service-registry
    runtime: docker
    plan: free
    dockerfilePath: ./service-registry/Dockerfile
    dockerContext: ./service-registry
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8761"
      - key: SPRING_PROFILES_ACTIVE
        value: render

  # ==========================================================================
  # API GATEWAY
  # ==========================================================================
  - type: web
    name: api-gateway
    runtime: docker
    plan: free
    dockerfilePath: ./api-gateway/Dockerfile
    dockerContext: ./api-gateway
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8080"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: JWT_SECRET
        value: "mySecretKeyForJWTTokenGenerationWhichShouldBeAtLeast256BitsLongForHS256Algorithm2024"
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  # ==========================================================================
  # BUSINESS SERVICES
  # ==========================================================================
  
  - type: web
    name: user-auth-service
    runtime: docker
    plan: free
    dockerfilePath: ./user-auth-service/Dockerfile
    dockerContext: ./user-auth-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8081"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: JWT_SECRET
        value: "mySecretKeyForJWTTokenGenerationWhichShouldBeAtLeast256BitsLongForHS256Algorithm2024"
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: restaurant-service
    runtime: docker
    plan: free
    dockerfilePath: ./restaurant-service/Dockerfile
    dockerContext: ./restaurant-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8082"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: menu-service
    runtime: docker
    plan: free
    dockerfilePath: ./menu-service/Dockerfile
    dockerContext: ./menu-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8083"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: cart-service
    runtime: docker
    plan: free
    dockerfilePath: ./cart-service/Dockerfile
    dockerContext: ./cart-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8084"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: order-service
    runtime: docker
    plan: free
    dockerfilePath: ./order-service/Dockerfile
    dockerContext: ./order-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8085"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: payment-service
    runtime: docker
    plan: free
    dockerfilePath: ./payment-service/Dockerfile
    dockerContext: ./payment-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8086"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: delivery-service
    runtime: docker
    plan: free
    dockerfilePath: ./delivery-service/Dockerfile
    dockerContext: ./delivery-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8087"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: notification-service
    runtime: docker
    plan: free
    dockerfilePath: ./notification-service/Dockerfile
    dockerContext: ./notification-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8088"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

  - type: web
    name: admin-service
    runtime: docker
    plan: free
    dockerfilePath: ./admin-service/Dockerfile
    dockerContext: ./admin-service
    healthCheckPath: /actuator/health
    envVars:
      - key: SERVER_PORT
        value: "8090"
      - key: SPRING_PROFILES_ACTIVE
        value: render
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: food-delivery-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: food-delivery-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: food-delivery-db
          property: password
      - key: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
        value: "https://service-registry-s4hd.onrender.com/eureka/"

# ============================================================================
# DATABASE (Using existing database)
# ============================================================================
databases:
  - name: food-delivery-db-s4hd
    plan: free
    databaseName: food_delivery
    user: food_delivery_user
