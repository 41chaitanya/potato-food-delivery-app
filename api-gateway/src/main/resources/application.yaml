# =============================================================================
# API-GATEWAY - Production Ready Configuration
# =============================================================================

spring:
  application:
    name: API-GATEWAY
  config:
    import: optional:configserver:${CONFIG_SERVER_URI:http://localhost:8089}

  # Redis Configuration - Production Ready (for rate limiting)
  cache:
    type: ${SPRING_CACHE_TYPE:redis}
  
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 5000ms

  cloud:
    gateway:
      server:
        webflux:
          routes:
            - id: auth-service
              uri: lb://USER-AUTH-SERVICE
              predicates:
                - Path=/api/auth/**
            - id: order-service
              uri: lb://ORDER-SERVICE
              predicates:
                - Path=/api/orders/**
            - id: payment-service
              uri: lb://PAYMENT-SERVICE
              predicates:
                - Path=/api/payments/**
            - id: menu-service
              uri: lb://MENU-SERVICE
              predicates:
                - Path=/api/menus/**
            - id: restaurant-service
              uri: lb://RESTAURANT-SERVICE
              predicates:
                - Path=/api/restaurants/**
            - id: cart-service
              uri: lb://CART-SERVICE
              predicates:
                - Path=/api/cart/**
            - id: delivery-service
              uri: lb://DELIVERY-SERVICE
              predicates:
                - Path=/api/delivery/**
            - id: admin-service
              uri: lb://ADMIN-SERVICE
              predicates:
                - Path=/api/admin/**
            - id: notification-service
              uri: lb://NOTIFICATION-SERVICE
              predicates:
                - Path=/api/notifications/**

server:
  port: ${SERVER_PORT:8080}

jwt:
  secret: ${JWT_SECRET:mySecretKeyForJWTTokenGenerationWhichShouldBeAtLeast256BitsLongForHS256Algorithm2024}

eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_URI:http://localhost:8761/eureka}
  instance:
    hostname: ${HOSTNAME:localhost}
    prefer-ip-address: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,gateway
  endpoint:
    health:
      show-details: when_authorized
